# Agents.md - Grype & Syft MCP ワークフロー

## プロジェクト概要
このプロジェクトは、Model Context Protocol (MCP) を介して **Syft**（SBOM生成）と **Grype**（脆弱性スキャン）を統合したセキュリティ分析ツールです。AIエージェントはこれらのツールを組み合わせ、ソフトウェアサプライチェーンの安全性を評価します。

## 利用可能なツール (MCP Tools)
AIは以下のツールを適切な順序で組み合わせて使用すること。

1. `generate_sbom(path)`
   - Syftを実行し、指定されたパスのSBOM（CycloneDX JSON形式）を生成する。
   - 解析の第一歩として使用し、プロジェクトの全依存関係を把握する。

2. `scan_vulnerability(source)`
   - Grypeを実行し、SBOMまたはディレクトリから脆弱性を検出する。
   - 出力はJSON形式で受け取り、深刻度（Severity）が高いものから優先的に分析する。

3. `analyze_risk(cve_id, package_info)`
   - 検出された脆弱性が実際のプロジェクト構造においてどの程度危険かを判断する。

## 推奨ワークフロー
ユーザーからセキュリティチェックの依頼があった場合、以下の手順で実行すること。
1. **解析**: `generate_sbom` でプロジェクトの構成を可視化。
2. **検知**: `scan_vulnerability` で既知の脆弱性（CVE）を特定。
3. **報告**: 深刻度、修正バージョン、および影響を受けるパスを整理してユーザーに提示。
4. **改善**: 依存関係ファイル（package.json, go.mod等）の更新案を具体的に作成。

## 命名規則とコードスタイル
- **言語**: Python 3.10+ (MCP Python SDK)
- **パッケージ管理**: `uv` を使用
- **型定義**: Python の Type Hits を必須とし、Pydantic モデルで入出力を定義。
- **エラー処理**: CLIツール（Syft/Grype）が未インストールの場合や、スキャン失敗時の例外処理を明示的に行う。

## コマンドライン実行例
開発・テスト用の基本コマンド：
- サーバー起動: `uv run mcp-server-sec`
- Syft単体確認: `syft . -o cyclonedx-json`
- Grype単体確認: `grype sbom:./sbom.json`

## セキュリティガイドライン
- スキャン対象のパスは必ずバリデーションを行い、システムディレクトリへのアクセスを制限すること。
- 脆弱性DBの更新を妨げないよう、ネットワーク接続が必要な場合はユーザーに通知すること。
